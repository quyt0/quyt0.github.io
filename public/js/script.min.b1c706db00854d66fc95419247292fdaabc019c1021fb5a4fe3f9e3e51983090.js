document.addEventListener("DOMContentLoaded",()=>{initTheme(),initLightbox(),initTableOfContents(),initSearch(),initMobileMenu()});function initTheme(){const e=document.querySelector(".main-header__btn-toggle-theme"),n=document.documentElement;if(!e)return;const t=e.querySelector("i"),s={latte:"#E6E9EF",mocha:"#181825"},i=document.querySelector('meta[name="theme-color"]')||(()=>{const e=document.createElement("meta");return e.name="theme-color",document.head.appendChild(e),e})(),a=localStorage.getItem("theme")||"latte";o(a),e.addEventListener("click",()=>{const e=n.getAttribute("data-theme"),t=e==="mocha"?"latte":"mocha";o(t)});function o(e){n.setAttribute("data-theme",e),localStorage.setItem("theme",e),c(e),r(e)}function r(e){i.setAttribute("content",s[e]||s.latte)}function c(e){if(!t)return;e==="latte"?t.classList.replace("fa-sun","fa-moon"):t.classList.replace("fa-moon","fa-sun")}}function initLightbox(){const e=document.getElementById("lightbox-overlay");if(!e)return;const n=document.getElementById("lightbox-img"),o=document.getElementById("lightbox-caption"),s=document.querySelector(".lightbox-close"),i=document.querySelectorAll(".lightbox-trigger");i.forEach(t=>{t.addEventListener("click",function(t){t.preventDefault(),e.style.display="flex",n.src=this.href;const s=this.getAttribute("data-caption");o.innerHTML=s||""})});const t=()=>{e.style.display="none",n.src=""};s&&s.addEventListener("click",t),e.addEventListener("click",n=>{n.target===e&&t()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&e.style.display==="flex"&&t()})}function initTableOfContents(){const e=document.querySelector("#TableOfContents"),t=document.querySelector(".main-content__article-body-content");if(!e||!t)return;const n=t.querySelectorAll("h2, h3, h4"),s=e.querySelectorAll("a");if(n.length===0)return;const o={root:null,rootMargin:"0px 0px -80% 0px",threshold:0},i=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const o=t.target.getAttribute("id");if(!o)return;const n=e.querySelector(`a[href="#${o}"]`);if(n){s.forEach(e=>{e.classList.remove("active"),e.parentElement?.classList.remove("active"),e.parentElement?.classList.remove("open")}),n.classList.add("active"),n.parentElement?.classList.add("active");let t=n.closest("li");for(;t&&t!==e;)t.classList.add("open"),t=t.parentElement?.closest("li")}}})},o);n.forEach(e=>i.observe(e))}function initSearch(){const t=document.querySelector(".main-header__search-box"),e=document.getElementById("main_header__search-results");if(!t||!e)return;let n,s=!1;const o=async()=>{if(s)return;try{const e=await fetch("/index.json"),t=await e.json(),o={keys:["title","contents","categories"],threshold:.4,ignoreLocation:!0,minMatchCharLength:2};n=new Fuse(t,o),s=!0}catch(e){console.error("Error loading index.json:",e)}};t.addEventListener("focus",o),t.addEventListener("input",function(t){if(!s||!n)return;const o=t.target.value.trim();if(e.innerHTML="",o.length<2){e.style.display="none";return}const i=n.search(o);if(i.length>0){e.style.display="block";const t=new Set;for(const o of i){const n=o.item;if(t.has(n.title))continue;t.add(n.title);const s=document.createElement("li");s.innerHTML=`
                    <a href="${n.permalink}">
                        <span class="main-header__search-item-title">${n.title}</span>
                    </a>
                `,e.appendChild(s)}}else e.style.display="block",e.innerHTML=`
                <li style="padding: 15px; text-align: center; color: var(--ctp-subtext0);">
                    No results found.
                </li>`}),document.addEventListener("click",function(n){!t.contains(n.target)&&!e.contains(n.target)&&(e.style.display="none")})}function initMobileMenu(){const t=document.querySelector(".main-header__btn-mobile-bar"),e=document.getElementById("main-header-mobile-menu");if(!t||!e)return;const n=()=>{e.setAttribute("hidden",""),t.setAttribute("aria-expanded","false")};t.addEventListener("click",()=>{const s=!e.hasAttribute("hidden");s?n():(e.removeAttribute("hidden"),t.setAttribute("aria-expanded","true"))}),e.addEventListener("click",e=>{e.target.closest("a")&&n()}),document.addEventListener("click",s=>{if(e.hasAttribute("hidden"))return;if(t.contains(s.target)||e.contains(s.target))return;n()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&n()});const s=window.matchMedia("(min-width: 768px)");s.addEventListener?.("change",e=>{e.matches&&n()})}