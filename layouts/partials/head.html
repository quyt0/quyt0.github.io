<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        {{ if .IsHome }}
        {{ .Site.Title }}
        {{ else if eq .Kind "term" }}
        {{ title .Data.Singular }}: {{ .Title }} | {{ .Site.Title }}
        {{ else }}
        {{ .Title }} | {{ .Site.Title }}
        {{ end }}
    </title>
    <link rel="stylesheet" href="/css/normalize.min.css">
    <link rel="stylesheet" href="/css/bootstrap-grid-5.3.8.css">
    <link rel="stylesheet" href="/css/fontawesome-7.1.0/css/all.min.css">
    {{ $syntax := resources.Get "css/syntax.css" | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $syntax.RelPermalink }}" integrity="{{ $syntax.Data.Integrity }}">
    <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="blog của Cuýt" />
    <link rel="manifest" href="/images/site.webmanifest" />
    <link rel="preload" href="/fonts/JetBrainsMono/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <script src="/js/fuse.basic.min.js"></script>
    {{ $css := resources.Get "css/style.css" | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $css.RelPermalink }}" integrity="{{ $css.Data.Integrity }}">
    
    {{/* --- Description priority --- */}}
    {{- $desc := "" -}}
    {{- if .IsHome -}}
        {{- $desc = .Site.Params.description | default .Site.Title -}}
    {{- else -}}
        {{- $desc = .Description | default (.Summary | plainify) | default .Site.Params.description | default .Site.Title -}}
    {{- end -}}

    {{/* --- Title priority --- */}}
    {{- $title := "" -}}
    {{- if .IsHome -}}
    {{- $title = .Site.Title -}}
    {{- else -}}
    {{- $title = printf "%s | %s" .Title .Site.Title -}}
    {{- end -}}

    {{/* --- Canonical + robots --- */}}
    <link rel="canonical" href="{{ .Permalink }}">
    <meta name="robots" content="index,follow,max-image-preview:large">
    <meta name="googlebot" content="index,follow">

    {{/* --- Basic meta --- */}}
    <meta name="description" content="{{ $desc }}">

    {{/* --- Open Graph --- */}}
    <meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}">
    <meta property="og:description" content="{{ $desc }}">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:type" content="{{ if .IsHome }}website{{ else if .IsPage }}article{{ else }}website{{ end }}">

    {{- $ogImg := "" -}}
    {{- $ogImgType := "" -}}
    {{- $ogImgWebp := "" -}}

    {{/* 1) Ưu tiên: ảnh của bài viết (page bundle) */}}
    {{- with .Params.image -}}
    {{- with $.Resources.GetMatch . -}}
        {{- $webp := .Process "webp" -}}
        {{- $ogImg = .Permalink -}}
        {{- $ogImgType = .MediaType.Type -}}
        {{- $ogImgWebp = $webp.Permalink -}}
    {{- end -}}
    {{- end -}}

    {{/* 2) Fallback: default OG cho home (và mọi trang không có Params.image) từ assets */}}
    {{- if not $ogImg -}}
    {{- $defaultOgSrc := "images/og-default.jpg" -}} {{/* đổi đúng tên file của bạn */}}
    {{- with resources.Get $defaultOgSrc -}}
        {{- $og := .Fit "1200x630" -}}          {{/* ảnh gốc */}}
        {{- $ogWebp := .Fit "1200x630 webp" -}} {{/* bản webp */}}
        {{- $ogImg = $og.Permalink -}}
        {{- $ogImgType = $og.MediaType.Type -}}
        {{- $ogImgWebp = $ogWebp.Permalink -}}
    {{- end -}}
    {{- end -}}

    {{/* 3) Output meta nếu có ảnh */}}
    {{- if $ogImg -}}
    <meta property="og:image" content="{{ $ogImg }}">
    {{- if $ogImgType -}}<meta property="og:image:type" content="{{ $ogImgType }}">{{- end -}}

    {{- if $ogImgWebp -}}
    <meta property="og:image" content="{{ $ogImgWebp }}">
    <meta property="og:image:type" content="image/webp">
    {{- end -}}

    <meta name="twitter:image" content="{{ $ogImg }}">
    {{- end -}}



    {{/* --- Twitter --- */}}
    <meta name="twitter:card" content="summary_large_image">

</head>